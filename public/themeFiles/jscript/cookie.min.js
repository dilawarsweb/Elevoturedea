(function() { const modalId = 'user-consent-modal'; const mainViewClass = 'user-consent-main-view'; const settingsViewClass = 'user-consent-settings-view'; const overlayClass = 'user-consent-overlay'; const acceptAllBtnClass = 'user-consent-accept-all'; const rejectAllBtnClass = 'user-consent-reject-all'; const managePrefsBtnClass = 'user-consent-manage-prefs'; const savePrefsBtnClass = 'user-consent-save-prefs'; const backBtnClass = 'user-consent-back'; const modal = document.getElementById(modalId); if (!modal) return; const mainView = modal.querySelector(`.${mainViewClass}`); const settingsView = modal.querySelector(`.${settingsViewClass}`); const overlay = modal.querySelector(`.${overlayClass}`); const acceptAllBtn = modal.querySelector(`.${acceptAllBtnClass}`); const rejectAllBtn = modal.querySelector(`.${rejectAllBtnClass}`); const managePrefsBtn = modal.querySelector(`.${managePrefsBtnClass}`); const savePrefsBtn = modal.querySelector(`.${savePrefsBtnClass}`); const backBtn = modal.querySelector(`.${backBtnClass}`); const essentialCheckbox = document.getElementById('cookie-essential'); const analyticsCheckbox = document.getElementById('cookie-analytics'); const marketingCheckbox = document.getElementById('cookie-marketing'); const storageKey = 'cookieConsentPreferences'; function getPreferences() { try { const prefs = localStorage.getItem(storageKey); return prefs ? JSON.parse(prefs) : null; } catch (e) { return null; } } function savePreferences(prefs) { try { localStorage.setItem(storageKey, JSON.stringify(prefs)); hideModal(); } catch (e) { // Error saving to localStorage } } function showModal() { modal.style.display = 'flex'; showMainView(); } function hideModal() { modal.style.display = 'none'; } function showMainView() { mainView.style.display = 'block'; settingsView.style.display = 'none'; } function showSettingsView() { mainView.style.display = 'none'; settingsView.style.display = 'block'; loadSettingsIntoCheckboxes(); } function loadSettingsIntoCheckboxes() { const prefs = getPreferences() || { essential: true, analytics: false, marketing: false }; if (essentialCheckbox) essentialCheckbox.checked = prefs.essential; if (analyticsCheckbox) analyticsCheckbox.checked = prefs.analytics; if (marketingCheckbox) marketingCheckbox.checked = prefs.marketing; } function handleAcceptAll() { savePreferences({ essential: true, analytics: true, marketing: true }); } function handleRejectAll() { savePreferences({ essential: true, analytics: false, marketing: false }); } function handleSavePreferences() { const prefs = { essential: essentialCheckbox ? essentialCheckbox.checked : true, analytics: analyticsCheckbox ? analyticsCheckbox.checked : false, marketing: marketingCheckbox ? marketingCheckbox.checked : false }; savePreferences(prefs); } // Event Listeners if (acceptAllBtn) acceptAllBtn.addEventListener('click', handleAcceptAll); if (rejectAllBtn) rejectAllBtn.addEventListener('click', handleRejectAll); if (managePrefsBtn) managePrefsBtn.addEventListener('click', showSettingsView); if (savePrefsBtn) savePrefsBtn.addEventListener('click', handleSavePreferences); if (backBtn) backBtn.addEventListener('click', showMainView); if (overlay) overlay.addEventListener('click', hideModal); // Initial check on page load document.addEventListener('DOMContentLoaded', () => { const existingPrefs = getPreferences(); if (!existingPrefs) { showModal(); } }); })();